{% extends "base.html" %}
{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<div class="detail">
  <div class="container">
    <a href="/" class="detail__back">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
        <line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/>
      </svg>
      All events
    </a>

    <div class="detail__layout">
      <!-- Left col -->
      <div>
        {% if event.image_url %}
        <div class="detail__img">
          <img src="{{ event.image_url }}" alt="{{ event.title }}">
        </div>
        {% endif %}

        <div class="detail__tags">
          {% for tag in event.tags %}
            <span class="tag">{{ tag.name }}</span>
          {% endfor %}
          {% if event.is_online %}<span class="online-badge">Online</span>{% endif %}
        </div>

        <h1 class="detail__title">{{ event.title }}</h1>

        {% if event.description %}
        <p class="detail__desc">{{ event.description }}</p>
        {% endif %}

        {% if user and user.role == 'admin' %}
        <hr class="divider">
        <div style="display:flex;gap:12px;">
          <a href="/admin/events/{{ event.id }}/edit" class="btn btn-ghost btn-sm">
            <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit
          </a>
          <form method="POST" action="/admin/events/{{ event.id }}/delete" onsubmit="return confirm('Delete this event?')">
            <button type="submit" class="btn btn-danger btn-sm">
              <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6m5 0V4h4v2"/>
              </svg>
              Delete
            </button>
          </form>
        </div>
        {% endif %}
      </div>

      <!-- Sidebar -->
      <aside class="detail__sidebar">
        <div class="sidebar-card">
          <div class="sidebar-card__price">
            {% if event.price == 0 or event.price is none %}
              <span style="color:var(--success);font-size:20px;font-family:var(--font-mono);text-transform:uppercase;letter-spacing:.06em;">Free</span>
            {% else %}
              $ {{ "%.2f"|format(event.price|float) }}
              <span>USD</span>
            {% endif %}
          </div>

          <div class="meta-item" style="margin-bottom:14px;">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <div>
              <div style="color:var(--text);font-size:13px;">{{ event.date_start.strftime('%d %B %Y') if event.date_start else '—' }}</div>
              <div style="color:var(--muted);font-size:11px;">{{ event.date_start.strftime('%H:%M') if event.date_start else '' }}
                {% if event.date_end %}– {{ event.date_end.strftime('%H:%M') }}{% endif %}
              </div>
            </div>
          </div>

          {% if event.registration_deadline %}
          <div class="meta-item" style="margin-bottom:14px;">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
            </svg>
            <div>
              <div style="color:var(--text);font-size:13px;">{{ event.registration_deadline.strftime('%d %B %Y') }}</div>
              <div style="color:var(--muted);font-size:11px;">Registration deadline</div>
            </div>
          </div>
          {% endif %}

          {% if event.location_address %}
          <div class="meta-item" style="margin-bottom:14px;">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            <div>
              <div style="color:var(--text);font-size:13px;">{{ event.location_address }}</div>
              {% if event.is_online %}<div style="color:var(--success);font-size:11px;">Online</div>{% endif %}
            </div>
          </div>
          {% endif %}

          {% if organizer %}
          <div class="meta-item" style="margin-bottom:0;">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <div>
              <div style="color:var(--text);font-size:13px;">{{ organizer.name }}</div>
              {% if organizer.contact_email %}
              <div style="color:var(--muted);font-size:11px;">{{ organizer.contact_email }}</div>
              {% endif %}
            </div>
          </div>
          {% endif %}

          <div class="sidebar-actions">
            {% if event.website_url %}
            <a href="{{ event.website_url }}" target="_blank" class="btn btn-primary">
              Register →
            </a>
            {% endif %}

            {% if user %}
              {% if is_bookmarked %}
              <form method="POST" action="/bookmarks/{{ event.id }}/remove">
                <button type="submit" class="btn btn-ghost" style="width:100%;justify-content:center;">
                  <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/>
                  </svg>
                  Remove Bookmark
                </button>
              </form>
              {% else %}
              <form method="POST" action="/bookmarks/{{ event.id }}">
                <button type="submit" class="btn btn-ghost" style="width:100%;justify-content:center;">
                  <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/>
                  </svg>
                  Bookmark
                </button>
              </form>
              {% endif %}
            {% else %}
            <a href="/login" class="btn btn-ghost" style="justify-content:center;">
              Login to bookmark
            </a>
            {% endif %}
          </div>
        </div>
      </aside>
    </div>
  </div>
</div>
{% endblock %}